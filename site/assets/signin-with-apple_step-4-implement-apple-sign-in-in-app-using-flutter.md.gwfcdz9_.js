import{_ as t,o,c as n,ae as i}from"./chunks/framework.Dn7Y7LSn.js";const r="/assets/Screenshot%202024-10-18%20at%2012.22.29.DBUCjzXu.png",s="/assets/Screenshot%202024-10-18%20at%2012.23.47.UMgQS_bx.png",p="/assets/Screenshot%202024-10-18%20at%2012.26.05.cGKyZy4t.png",l="/assets/Screenshot%202024-10-18%20at%2012.27.39.BGyACfRb.png",a="/assets/Screenshot%202024-10-18%20at%2012.29.42.BomVtHX5.png",g="/assets/Screenshot%202024-10-18%20at%2012.59.28.BXk8S8xi.png",u="/assets/client-secret.DWSDp1qq.webp",c="/assets/request.B7g3YZ3j.webp",b=JSON.parse('{"title":"Step 4: Implement Apple Sign-In in App (Using Flutter)","description":"Here we are using flutter and install required package to implemen","frontmatter":{"description":"Here we are using flutter and install required package to implemen"},"headers":[],"relativePath":"signin-with-apple/step-4-implement-apple-sign-in-in-app-using-flutter.md","filePath":"signin-with-apple/step-4-implement-apple-sign-in-in-app-using-flutter.md"}'),d={name:"signin-with-apple/step-4-implement-apple-sign-in-in-app-using-flutter.md"};function h(f,e,y,m,w,A){return o(),n("div",null,[...e[0]||(e[0]=[i('<h1 id="step-4-implement-apple-sign-in-in-app-using-flutter" tabindex="-1">Step 4: Implement Apple Sign-In in App (Using Flutter) <a class="header-anchor" href="#step-4-implement-apple-sign-in-in-app-using-flutter" aria-label="Permalink to &quot;Step 4: Implement Apple Sign-In in App (Using Flutter)&quot;">​</a></h1><p><strong>1. Add Required Dependencies</strong></p><p>To begin integrating <strong>Sign in with Apple</strong> into your Flutter project, you’ll need to add the appropriate packages. Open the <code>pubspec.yaml</code> file and add the following dependency:</p><figure><img src="'+r+'" alt=""><figcaption><p>This must be in your pubspec.yaml file</p></figcaption></figure><p>Then, run:</p><figure><img src="'+s+'" alt=""><figcaption><p>Hit pub get in terminal/bash</p></figcaption></figure><p>This will install the <strong>sign_in_with_apple</strong> package which provides the API to handle the authentication process.</p><p><strong>2. Configure the iOS Project for Apple Sign-In</strong></p><p>You’ve already enabled <strong>Sign in with Apple</strong> capability in Xcode (as per the previous steps). Now, we need to make sure Flutter and Xcode are set up for the feature to work properly.</p><ul><li><strong>Open the iOS folder of your Flutter app</strong> in Xcode: <ul><li>Navigate to <code>ios/Runner.xcworkspace</code> in your Flutter project and open it in Xcode.</li></ul></li><li><strong>Update the Info.plist file</strong>: <ul><li>Add the following to your <code>Info.plist</code> to configure the usage description and URL schemes for Apple Sign-In:</li></ul></li></ul><figure><img src="'+p+'" alt=""><figcaption><p>configure this in Info.plist</p></figcaption></figure><p>Make sure to replace <code>&quot;your.bundle.identifier&quot;</code> with your app’s actual bundle ID.</p><ul><li><strong>Enable Keychain Sharing (Optional)</strong>: <ul><li>If you want to enable seamless sign-in across multiple devices, make sure <strong>Keychain Sharing</strong> is enabled in Xcode. Go to the <strong>Signing &amp; Capabilities</strong> tab and add <strong>Keychain Sharing</strong>.</li></ul></li></ul><p><strong>3. Implement the Apple Sign-In Logic</strong></p><p>Now, you need to implement the actual sign-in logic in your Flutter app using the <strong>sign_in_with_apple</strong> package.</p><ul><li><strong>Import the Apple Sign-In Package</strong>: </li></ul><figure><img src="'+l+'" alt=""><figcaption><p>import the package in your UI</p></figcaption></figure><p><strong>Create the Apple Sign-In Button</strong>: You can add an Apple sign-in button to your app’s UI by using the built-in button widget:</p><figure><img src="'+a+'" alt=""><figcaption><p>you can customize your button</p></figcaption></figure><p><strong>Explanation of the <code>getAppleIDCredential</code> Method</strong>:</p><ul><li><code>AppleIDAuthorizationScopes.email</code> and <code>AppleIDAuthorizationScopes.fullName</code>: These are the data fields you’re requesting from Apple. You can ask for the user&#39;s email and full name.</li><li><code>identityToken</code>: A JWT token that you can verify on your backend server for secure sign-in.</li></ul><p><strong>4. Handle the Apple Sign-In Response</strong></p><p>You will get the user&#39;s email, identity token, and full name from Apple after a successful sign-in. Use these to authenticate the user in your app. This is what the response data looks like:</p><ul><li><strong>Email</strong>: May only be available the first time the user signs in.</li><li><strong>Full Name</strong>: The user’s first and last name (if provided).</li><li><strong>Identity Token</strong>: This JWT is used to verify the user&#39;s identity and can be used with a backend server for authentication.</li></ul><p><strong>5. Backend(Nodejs) flow</strong></p><p><strong>In backend (key id, Team id, service id , private key ) must be configured (setup in backend)</strong></p><p><strong>Required Parameters Explanation:</strong></p><ul><li><strong>TEAM_ID (<code>iss</code>)</strong>: Your <strong>Apple Developer Team ID</strong>. This can be found in your Apple Developer account.</li><li><strong>Key ID (<code>kid</code>)</strong>: The Key ID from the key you created in your Apple Developer account for <strong>Sign in with Apple</strong>. <ul><li><em>The file will be named something like <code>AuthKey_XXXXXXXXXX.p8</code>, where <code>XXXXXXXXXX</code> is your <strong>Key ID</strong></em></li></ul></li><li><strong>Service ID (<code>sub</code>)</strong>: This is your app’s <strong>Client ID</strong>, which is the <strong>Service ID</strong> you created in your Apple Developer account.</li><li><strong>Private Key (<code>.p8</code> file)</strong>: This is the private key downloaded from Apple Developer when you set up the <strong>Sign in with Apple</strong> key.</li></ul><p><strong>5.1 Generate .p8 file(private key)</strong></p><p>To obtain the <strong>Private Key (.p8 file)</strong> needed for generating the <strong>Client Secret</strong> for <strong>Sign in with Apple</strong>, you need to create it in your Apple Developer account. Here&#39;s how to do that step-by-step:</p><h4 id="steps-to-get-the-p8-private-key-for-sign-in-with-apple" tabindex="-1">Steps to Get the <code>.p8</code> Private Key for Sign in with Apple <a class="header-anchor" href="#steps-to-get-the-p8-private-key-for-sign-in-with-apple" aria-label="Permalink to &quot;Steps to Get the `.p8` Private Key for Sign in with Apple&quot;">​</a></h4><p><strong>5.1.1. Go to Apple Developer Account</strong></p><ul><li>Log in to your <a href="https://developer.apple.com/account/" target="_blank" rel="noreferrer">Apple Developer Account</a>.</li></ul><p><strong>5.1.2. Navigate to the Keys Section</strong></p><ul><li>On the left-hand menu, under <strong>Certificates, Identifiers &amp; Profiles</strong>, select <strong>Keys</strong>.</li></ul><p><strong>5.1.3. Create a New Key</strong></p><ul><li>Click on the &quot;+&quot; button in the top-right corner to create a new key.</li></ul><p><strong>5.1.4. Configure the Key</strong></p><ul><li>Name your key something descriptive, like &quot;Sign in with Apple Key.&quot;</li><li><strong>Check the box</strong> next to <strong>Sign in with Apple</strong> under the Key Services section.</li></ul><p><strong>5.1.5. Register the Key</strong></p><ul><li>Once you&#39;ve enabled <strong>Sign in with Apple</strong>, click <strong>Continue</strong> and review your key information.</li><li>Click <strong>Register</strong> to complete the process.</li></ul><p><strong>5.1.6. Download the Private Key (.p8 file)</strong></p><ul><li>After registering, you will be prompted to download the <strong>.p8 private key</strong> file. This file is only available for download once, so <strong>make sure to save it securely</strong> (e.g., somewhere safe on your local machine or in a secure cloud storage).</li><li>The file will be named something like <code>AuthKey_XXXXXXXXXX.p8</code>, where <code>XXXXXXXXXX</code> is your <strong>Key ID</strong>.</li></ul><p><strong>5.1.7. Make a Note of the Key ID</strong></p><ul><li>As soon as the key is created, you will also receive a <strong>Key ID</strong>. Note this down because you will need it to generate the <strong>Client Secret (JWT)</strong> in your backend.</li></ul><p>Generate the <strong>Client Secret</strong> (JWT) in backend required for <strong>Sign in with Apple</strong></p><p>To generate the <strong>Client Secret</strong> (JWT) required for <strong>Sign in with Apple</strong>, you&#39;ll need to create a <strong>JSON Web Token (JWT)</strong> signed with your Apple Developer <strong>private key</strong> (<code>.p8</code> file). This is used to authenticate your app with Apple’s servers.</p><p>Here’s a step-by-step guide, focusing on how to generate the secret key (Client Secret) in <strong>Node.js</strong>. This method works regardless of whether you&#39;re using Node.js for your backend or want to understand the process better for any language.</p><h4 id="prerequisites" tabindex="-1">Prerequisites: <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;Prerequisites:&quot;">​</a></h4><ol><li><strong>Apple Developer Account</strong>: You should already have: <ul><li><strong>App ID (Client ID)</strong>.</li><li><strong>Private Key (.p8)</strong> file.</li><li><strong>Key ID</strong> and <strong>Team ID</strong> from your Apple Developer account.</li></ul></li><li><strong>jsonwebtoken</strong> library in Node.js (or similar library in other languages).</li></ol><h4 id="step-by-step-guide" tabindex="-1">Step-by-Step Guide: <a class="header-anchor" href="#step-by-step-guide" aria-label="Permalink to &quot;Step-by-Step Guide:&quot;">​</a></h4><p><strong>1. Install <code>jsonwebtoken</code> and <code>fs</code> packages</strong></p><figure><img src="'+g+'" alt=""><figcaption></figcaption></figure><p><strong>2. Generate the JWT (Client Secret) in Node.js</strong></p><p>Here’s an example of how to generate the <strong>JWT Client Secret</strong> using Node.js:</p><figure><img src="'+u+'" alt=""><figcaption></figcaption></figure><p><strong>3.Required Parameters Explanation:</strong></p><ul><li><strong>TEAM_ID (<code>iss</code>)</strong>: Your <strong>Apple Developer Team ID</strong>. This can be found in your Apple Developer account.</li><li><strong>Key ID (<code>kid</code>)</strong>: The Key ID from the key you created in your Apple Developer account for <strong>Sign in with Apple</strong>.</li><li><strong>Service ID (<code>sub</code>)</strong>: This is your app’s <strong>Client ID</strong>, which is the <strong>Service ID</strong> you created in your Apple Developer account.</li><li><strong>Private Key (<code>.p8</code> file)</strong>: This is the private key downloaded from Apple Developer when you set up the <strong>Sign in with Apple</strong> key.</li></ul><p><strong>4. JWT Fields:</strong></p><ul><li><code>iat</code> (Issued At): The current time in seconds (Unix time).</li><li><code>exp</code> (Expiration): The token&#39;s expiration time. Apple recommends that this token should not last more than 6 hours (3600 seconds * 6 = 21600 seconds).</li><li><code>aud</code>: Apple requires this to be <code>https://appleid.apple.com</code>.</li><li><code>sub</code>: Your <strong>Client ID</strong> (Service ID), which is the unique identifier for your app.</li><li><code>alg</code>: The encryption algorithm Apple uses is <code>ES256</code>.</li></ul><p><strong>5. What’s Next?</strong></p><p>Once you’ve generated the <strong>Client Secret</strong> (JWT), your backend can now use it to communicate with Apple&#39;s servers. This token is used when exchanging the <strong>authorization code</strong> or <strong>refresh token</strong> with Apple to authenticate and validate the user.</p><p>Now Example Request: </p><figure><img src="'+c+'" alt=""><figcaption></figcaption></figure><p>Now you are done.<br> You can sign in with apple now.</p>',65)])])}const S=t(d,[["render",h]]);export{b as __pageData,S as default};
